<!--
  ~  Copyright 2016 Ripple Foundation C.I.C. Ltd
  ~  
  ~  Licensed under the Apache License, Version 2.0 (the "License");
  ~  you may not use this file except in compliance with the License.
  ~  You may obtain a copy of the License at
  ~  
  ~    http://www.apache.org/licenses/LICENSE-2.0

  ~  Unless required by applicable law or agreed to in writing, software
  ~  distributed under the License is distributed on an "AS IS" BASIS,
  ~  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~  See the License for the specific language governing permissions and
  ~  limitations under the License.
  -->

<div mc-full-panel mc-datepicker class="panel-group">
  <div class="panel panel-secondary">
    <div class="panel-heading">
      <div class="control-group right">
        <button class="btn btn-success btn-inverse btn-square hidden-xs hidden-sm btn-expand-panel" ng-click="changeFullPanel('details')"><i class="btn-icon fa fa-expand"></i><i class="btn-icon fa fa-compress"></i></button>
      </div>
      <h3 class="panel-title">Create Transfer Of Care</h3>
    </div>
    <div class="panel-body">
      <div class="panel-body-inner">
        <form name="transferOfCareForm" class="form">
          <div class="form-group-wrapper">
            <div class="row-expand">
              <div class="col-expand-left">
                <div class="form-group" ng-class="{'has-error': (formSubmitted || transferOfCareForm.from.$dirty) && transferOfCareForm.from.$invalid, 'has-success': transferOfCareForm.from.$valid && transferOfCareForm.from.$dirty}">
                    <label for="from" class="control-label">From (Site / Org)</label>
                    <div class="input-holder">
                        <select class="form-control input-sm" id="from" name="from" ng-model="transferOfCareEdit.from" required ng-options="city disable when city === transferOfCareEdit.to for city in cities">
                            <option value="">-- Select from --</option>
                        </select>
                    </div>
                    <span class="help-block animate-fade" ng-show="formSubmitted && transferOfCareForm.from.$error.required">You must enter a value.</span>
                </div>
              </div>
              <div class="col-expand-right">
                <div class="form-group" ng-class="{'has-error': (formSubmitted || transferOfCareForm.to.$dirty) && transferOfCareForm.to.$invalid, 'has-success': transferOfCareForm.to.$valid && transferOfCareForm.to.$dirty}">
                    <label for="to" class="control-label">To (Site / Org)</label>
                    <div class="input-holder">
                        <select class="form-control input-sm" id="to" name="to" ng-model="transferOfCareEdit.to" required ng-options="city disable when city === transferOfCareEdit.from for city in cities">
                            <option value="">-- Select to --</option>
                        </select>
                    </div>
                    <span class="help-block animate-fade" ng-show="formSubmitted && transferOfCareForm.to.$error.required">You must enter a value.</span>
                </div>
              </div>
            </div>

            <div class="form-group" ng-class="{'has-error': (formSubmitted || transferOfCareForm.type.$dirty) && transferOfCareForm.type.$invalid, 'has-success': transferOfCareForm.type.$valid && transferOfCareForm.type.$dirty}">
                <label for="type" class="control-label">Type</label>
                <div class="input-holder">
                    <select class="form-control input-sm" id="type" name="type" ng-model="transferOfCareEdit.type" required ng-options="item as item.title for item in typeRecords">
                        <option value="">-- Select type --</option>
                    </select>
                </div>
                <span class="help-block animate-fade" ng-show="formSubmitted && transferOfCareForm.type.$error.required">You must enter a value.</span>
            </div>

            <div ng-if="isShowTypeRecord(typeRecords.diagnosis)" class="form-group">
                <label for="diagnosisId" class="control-label">Problems / Diagnosis</label>
                <div class="input-holder">
                    <select class="form-control input-sm" id="diagnosisId" name="diagnosisId" ng-model="diagnosisSelected" ng-options="item for item in typeRecords.diagnosis" ng-change="addToRecords()">
                        <option value="">-- Select Problems / Diagnosis --</option>
                    </select>
                </div>
            </div>

            <div ng-if="!transferOfCareEdit.records.length" class="form-group">
              <div class="form-control-static">No records added</div>
            </div>
            
            <table ng-if="transferOfCareEdit.records.length" class="table table-striped table-hover table-bordered rwd-table table-sorted table-fixedcol">
              <colgroup>
                <col style="width: 18%;">
                <col style="width: 22%;">
                <col style="width: 22%;">
                <col style="width: 19%;">
                <col style="width: 19%;">
              </colgroup>
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Type</th>
                  <th>Date</th>
                  <th>Source</th>
                  <th></th>
                </tr>
              </thead>

              <tbody>
                <tr ng-repeat="record in transferOfCareEdit.records" ng-click="">
                  <td data-th="Name"><span>{{ record.name }}</span></td>
                  <td data-th="Type"><span>{{ record.type }}</span></td>
                  <td data-th="Date"><span>{{ record.date }}</span></td>
                  <td data-th="Source"><span>{{ record.source }}</span></td>
                  <td data-th=""><span><button class="btn btn-square btn-danger btn-icon-normal"><i class="btn-icon fa fa-times"></i></button></span></td>
                </tr>
              </tbody>
            </table>




            






            <div class="row-expand">
              <div class="col-expand-left">
                <div class="form-group" ng-class="{'has-error': (formSubmitted || transferOfCareForm.reasonForContact.$dirty) && transferOfCareForm.reasonForContact.$invalid, 'has-success': transferOfCareForm.reasonForContact.$valid && transferOfCareForm.reasonForContact.$dirty}">
                    <label for="reasonForContact" class="control-label">Reason for contact</label>
                    <div class="input-holder">
                        <textarea type="text" class="form-control textarea-big input-sm" id="reasonForContact" name="reasonForContact" ng-model="transferOfCareEdit.reasonForContact" required></textarea>
                    </div>
                    <span class="help-block animate-fade" ng-show="formSubmitted && transferOfCareForm.reasonForContact.$error.required">You must enter a value.</span>
                </div>
              </div>
              <div class="col-expand-right">
                <div class="form-group" ng-class="{'has-error': (formSubmitted || transferOfCareForm.clinicalSummary.$dirty) && transferOfCareForm.clinicalSummary.$invalid, 'has-success': transferOfCareForm.clinicalSummary.$valid && transferOfCareForm.clinicalSummary.$dirty}">
                    <label for="clinicalSummary" class="control-label">Clinical Summary</label>
                    <div class="input-holder">
                        <textarea type="text" class="form-control textarea-big input-sm" id="clinicalSummary" name="clinicalSummary" ng-model="transferOfCareEdit.clinicalSummary" required></textarea>
                    </div>
                    <span class="help-block animate-fade" ng-show="formSubmitted && transferOfCareForm.clinicalSummary.$error.required">You must enter a value.</span>
                </div>
              </div>
            </div>
           
          </div>
        </form>
      </div>
      <div class="panel-control" ng-if="$ctrl.currentUser.permissions.indexOf('WRITE') !== -1">
        <div class="wrap-control-group">
          <div class="control-group right">
            <button class="btn btn-danger" ng-click="$ctrl.cancel()"><i class="btn-icon fa fa-ban"></i> <span class="btn-text">Cancel</span></button>
            <button class="btn btn-success" ng-click="create(transferOfCareForm, transferOfCareEdit)"><i class="btn-icon fa fa-check"></i> <span class="btn-text">Complete</span></button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>