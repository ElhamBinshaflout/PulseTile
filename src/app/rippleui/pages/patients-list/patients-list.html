<!--
  ~  Copyright 2016 Ripple Foundation C.I.C. Ltd
  ~  
  ~  Licensed under the Apache License, Version 2.0 (the "License");
  ~  you may not use this file except in compliance with the License.
  ~  You may obtain a copy of the License at
  ~  
  ~    http://www.apache.org/licenses/LICENSE-2.0

  ~  Unless required by applicable law or agreed to in writing, software
  ~  distributed under the License is distributed on an "AS IS" BASIS,
  ~  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~  See the License for the specific language governing permissions and
  ~  limitations under the License.
  -->
<div table-settings order="name" filtering class="panel panel-primary">
  <div class="panel-heading">
    <div class="control-group right">
      <div class="dropdown">
        <button mc-dropdown class="btn btn-success btn-inverse btn-dropdown-toggle" ng-click="toggleDropdown($event);"><i class="fa fa-cog"></i></button>
        <div class="dropdown-menu dm-panel dm-right dm-summery">
          <div class="form-group-wrapper">
            <div ng-repeat="(itemKey, item) in patientsTable">
              <div class="heading">{{ item.title }}</div>
              <div class="form-group">
                <div class="row">
                  <div class="col-xs-6 col-sm-4" ng-repeat="(key, tableSettings) in item.settings">
                    <div class="wrap-fcustominp">
                      <div class="fcustominp-state" ng-class="{disabled: !!tableSettings.disabled}">
                        <div class="fcustominp">
                          <input type="checkbox" id="patients-table-{{ itemKey }}-{{ key }}" ng-change="changeTableSettings()" name="patients-table-{{ itemKey }}-{{ key }}" ng-model="tableSettings.select"  ng-disabled="{{ !!tableSettings.disabled }}"/>
                          <label for="patients-table-{{ itemKey }}-{{ key }}"></label>
                        </div>
                        <label for="patients-table-{{ itemKey }}-{{ key }}" class="fcustominp-label">{{ tableSettings.title }}</label>
                      </div>
                    </div>
                  </div>
                  <div class="col-xs-6 col-sm-4">
                    <button class="btn btn-success btn-inverse btn-smaller" ng-click="selectAllSettings(itemKey)">Select All</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <button class="btn btn-success btn-inverse btn-filter" ng-click="toggleFilter()"><i class="fa fa-filter"></i></button>
    </div>
    <h3 class="panel-title">
      Patient Info<span ng-if="$ctrl.filters.ageRange">. Age range: {{ $ctrl.filters.ageRange }}</span><span ng-if="$ctrl.filters.department">. Setting: {{$ctrl.filters.department}}</span>
    </h3>
    <div class="panel-filter" ng-show="isFilterOpen">
      <div class="inner-addon addon-left">
        <div class="addon">
          <i class="fa fa-filter"></i>
        </div>
        <input type="text" id="filter" class="form-control" placeholder="Filter..." ng-model="queryFilter"/>
      </div>
    </div>
  </div>
  <div class="panel-body">
    <div class="wrap-patients-table">
      <table class="table table-striped table-hover table-bordered rwd-table table-sorted table-fixedcol">
        <thead>
          <tr>
              <th ng-repeat="(key, item) in patientsTable.info.settings"
                  ng-click="sort(key)" 
                  ng-class="sortClass(key)"
                  ng-if="item.select">{{ item.title }}</th>
              <th ng-repeat="(key, item) in patientsTable.date.settings"
                  ng-click="sort(key)" 
                  ng-class="sortClass(key)"
                  ng-if="item.select"><span>{{ item.title }}</span><i class="fa fa-calendar"></i></th>
              <th ng-repeat="(key, item) in patientsTable.count.settings"
                  ng-click="sort(key + '#')" 
                  ng-class="sortClass(key + '#')"
                  ng-if="item.select">{{ item.title }} #</th>
              <th></th>
          </tr>
        </thead>

        <tbody>
          <tr dir-paginate="patient in $ctrl.patients | filter:queryFiltering | filter: $ctrl.patientFilter | orderBy:[order] : reverse | itemsPerPage: 10">
              <td ng-repeat="(key, item) in patientsTable.info.settings"
                  data-th='{{ item.title }}'
                  ng-class="sortClass(key)"
                  ng-if="item.select">{{ patient[key] }}</td>
              <td ng-repeat="(key, item) in patientsTable.date.settings"
                  data-th='{{ item.title }} Data'
                  ng-class="sortClass(key)"
                  ng-if="item.select">27-Jan-1947</td>
              <td ng-repeat="(key, item) in patientsTable.count.settings"
                  data-th='{{ item.title }} #'
                  ng-class="sortClass(key) + '#'"
                  ng-if="item.select">123</td>
              <!--           
                <td data-th="NHS No" 
                    ng-class="sortClass('nhsNumber')"
                    ng-if="patientsTable.info.settings.nhsNumber.select">{{ patient.nhsNumber | formatNHSNumber }}</td> -->
              <td class="patient-control">
                <div class="patient-buttons dropdown">
                  <button class="btn btn-success btn-inverse btn-sm btn-view-patient" ng-click="$ctrl.go(patient)">View</button>
                  <button mc-dropdown class="btn btn-success btn-inverse btn-sm btn-dropdown-toggle" ng-click="toggleDropdown($event);"></button>
                  <div class="dropdown-menu dm-right">
                    <div class="dm-wrap-list">
                      <div class="dm-list">
                        <div class="dm-item" ng-click="$ctrl.go(patient, 'orders')"><span>Orders</span></div>
                        <div class="dm-item" ng-click="$ctrl.go(patient, 'results')"><span>Results</span></div>
                        <div class="dm-item" ng-click="$ctrl.go(patient, 'vitals')"><span>Vitals</span></div>
                        <div class="dm-item" ng-click="$ctrl.go(patient, 'diagnoses')"><span>Diagnosis</span></div>
                      </div>
                    </div>
                  </div>
                </div>
              </td>
          </tr>

          <tr ng-if="!$ctrl.patients.length">
              <td colspan="5"><span class="label label-default">No patients found</span></td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="panel-control">
      <div class="wrap-control-group">
        <div class="control-group with-indent center">
          <dir-pagination-controls max-size="5" boundary-links="false"></dir-pagination-controls>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="row">

  <!-- <div class="col-md-3 col-sm-4 col-xs-12 form-group" ng-if="$ctrl.filters.ageRange">
    <div class="search-left-inner-addon">
      <i class="glyphicon glyphicon-list glyphicon-list-patients black-color-text"></i>
      <input class="form-control" placeholder=" Age range: {{$ctrl.filters.ageRange}}" readonly />
    </div>
  </div> -->

  <!-- <div class="col-md-3 col-sm-4 col-xs-12 form-group" ng-if="$ctrl.filters.department">
    <div class="search-left-inner-addon">
      <i class="glyphicon glyphicon-list glyphicon-list-patients black-color-text"></i>
      <input class="form-control" placeholder=" Setting: {{$ctrl.filters.department}}" readonly />
    </div>
  </div> -->

  <!-- <div class="col-md-3 col-sm-4 col-xs-12 form-group" ng-if="!$ctrl.filters.department && !$ctrl.filters.ageRange && !$ctrl.filters.advancedSearch">
    <div class="search-left-inner-addon">
      <i class="glyphicon glyphicon-list glyphicon-list-patients black-color-text"></i>
      <input class="form-control" placeholder=" Patients: All" readonly style="cursor: not-allowed"/>
    </div>
  </div> -->

  <!-- <div class="col-md-3 col-sm-4 col-xs-12 form-group" ng-if="$ctrl.filters.advancedSearch">
    <div class="search-left-inner-addon">
      <i class="glyphicon glyphicon-list glyphicon-list-patients black-color-text"></i>
      <input class="form-control patientFilterOptions" placeholder="Patients: {{$ctrl.filters.advancedSearchParams.forename}} {{$ctrl.filters.advancedSearchParams.surname}}, {{$ctrl.filters.advancedSearchParams.dateOfBirth | date:'dd-MMM-yyyy'}}" readonly ng-click="$ctrl.openAdvancedSearch()" />
      <i class="glyphicon fa fa-pencil" style="margin-left: 422px; color: #7cbe31;"></i>
    </div>
  </div> -->
</div>
